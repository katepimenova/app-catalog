<h3 ng-if="vm.type">{{vm.type|displayName}}</h3>
<form name="artifactForm">
<table>
  <tr ng-repeat="i in vm.formFields">
    <td><label for="{{i.name}}">{{i.name|displayName}}</label></td>
    <td ng-switch="i.widget">

      <select ng-switch-when="select" name="{{i.name}}" ng-model="vm.artifact[i.name]" ng-options="o as o for o in i.enum"></select>

      <input ng-switch-when="input" type="{{i.type}}" ng-model="vm.artifact[i.name]" name="{{i.name}}"
        ng-required="i.required" ng-class="i.type == 'file' || 'form-control'"></input>

      <div ng-switch-when="uploaded_blob">
        {{vm.artifact[i.name].content_type}}&nbsp;{{vm.artifact[i.name].size|blobSize}}
      </div>

      <div ng-switch-when="external_blob">
        <table>
          <tr>
            <td>
              <div class="sub-label">Url</div>
              <input name="{{i.name}}{{i.key}}" ng-model="vm.externalBlob[i.name]" class="form-control" />
            </td>
          </tr>
          <tr>
            <td>
              <div class="sub-label">Checksum</div>
              <input name="{{i.name}}{{i.key}}.checksum" ng-model="vm.externalBlobChecksum[i.name]" class="form-control" />
            </td>
          </tr>
        </table>
      </div>

      <textarea ng-switch-when="textarea" ng-model="vm.artifact[i.name]"
                name="{{i.name}}" ng-required="{{i.required}}" class="form-control"></textarea>

      <span ng-switch-when="array">
        <ul><li ng-repeat="item in vm.artifact[i.name] track by $index">
          <input ng-model="vm.artifact[i.name][$index]" type="{{i.itemType}}"
                 name="{{i.name}}.{{$index}}" class="form-control">
          </input>
          <button ng-click="vm.artifact[i.name].splice($index, 1)" class="btn btn-link">
            <i class="glyphicon glyphicon-minus-sign"></i>
          </button>
        </li></ul>
        <button ng-click="vm.addItem(i.name)" class="btn btn-link">
          <i class="glyphicon glyphicon-plus-sign"></i>
        </button>
      </span>

      <span ng-switch-when="dict">

        <table ng-if="i.itemType != 'file'">
          <tr ng-repeat="(key, val) in vm.artifact[i.name]">
            <td>
              <div class="sub-label">{{key}}</div>
              <input ng-model="vm.artifact[i.name][key]" type="{{i.itemType}}"
                     name={{i.name}}.{{key}} class="form-control">
              </input>
            </td>
            <td>
              <button ng-click="vm.delKey(i.name, key, 'artifact')" ng-if="!i.locked" class="btn btn-link">
                <i class="glyphicon glyphicon-minus-sign"></i>
              </button>
            </td>
          </tr>
        </table>

        <table ng-if="i.itemType == 'file'">
          <tr ng-repeat="(key, val) in vm.artifact[i.name]">
            <td>{{key}}</td>
            <td>{{val.content_type}} {{val.size|blobSize}}</td>
          </tr>
          <tr ng-repeat="(key, val) in vm.blobdict[i.name]">
            <td>{{key}}</td>
            <td>
              <input ng-model="vm.blobdict[i.name][key]" type="{{i.itemType}}"
                     ng-blobdict-key="{{key}}" name="{{i.name}}.{{key}}">
              </input>
            </td>
            <td>
              <button ng-click="vm.delKey(i.name, key, 'blobdict')" ng-if="!i.locked" class="btn btn-link">
                <i class="glyphicon glyphicon-minus-sign"></i>
              </button>
            </td>
          </tr>
        </table>

        <span ng-if="!i.locked && i.itemType != 'file'">
          <input ng-model="vm.newKey[i.name]" class="form-control"></input>
          <button ng-click="vm.addKey(i.name, 'artifact', 'newKey')" class="btn btn-link">
            <i class="glyphicon glyphicon-plus-sign"></i>
          </button>
        </span>

        <span ng-if="!i.locked && i.itemType == 'file'">
          <input ng-model="vm.newBlobDictKey[i.name]" class="form-control"></input>
          <button ng-click="vm.addKey(i.name, 'blobdict', 'newBlobDictKey')" class="btn btn-link">
            <i class="glyphicon glyphicon-plus-sign"></i>
          </button>
        </span>

      </span>

    </td>
  </tr>
</table>
</form>

<button ng-if="artifactForm.$valid" ng-click="vm.Save(artifactForm)" class="btn btn-default">Save</button>
<button ng-if="vm.is_admin && vm.artifact.status == 'active'" ng-click="vm.approve()" class="btn btn-default">Approve</button>
<button ng-if"vm.artifact.status != 'active'" ng-click="vm.Activate()" class="btn btn-default">Activate</button>


<table id="uploads" style="width: 6in;">
  <tr ng-repeat="upload in vm.uploading">
    <td>{{upload.name}}</td><td><div style="width: {{upload.progress}}%; background-color: green;">{{upload.progress}}%</td><td>{{upload.error}}</div></td>
  </tr>
</table>

<h2 ng-if="vm.status">{{vm.status}}</h2>
<div ng-if="vm.error" class="xhr_error alert alert-danger">
<p>{{vm.error.status}} {{vm.error.statusText}}</p>
<p>{{vm.error.data.error.message}}</p>
</div>

<h2 id="upload_progress"></h2>
